<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Retro Platformer â€” 3 Levels</title>
  <style>
    *,*::before,*::after {box-sizing:border-box;}
    :root {
      --panel-bg: rgba(10,10,10,0.9);
      --panel-border: #fff;
      --accent: #0ff;
      --text-muted: #c8c8c8;
    }
    body {
      margin:0;
      min-height:100vh;
      background:#050505;
      background-image:radial-gradient(circle at 20% -10%, #2a2a2a 0%, rgba(5,5,5,0.35) 35%),
        radial-gradient(circle at 80% 0%, rgba(50,50,50,0.5) 0%, rgba(5,5,5,0.05) 45%);
      color:#fff;
      font-family:monospace;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
    }
    .hidden {display:none !important;}
    .hud {margin:10px;}
    canvas {image-rendering:pixelated;border:2px solid #fff;background:#111;}
    button {
      margin-top:10px;
      padding:8px 12px;
      font-family:monospace;
      font-size:14px;
      letter-spacing:1px;
      color:#fff;
      background:linear-gradient(180deg, rgba(255,255,255,0.18) 0%, rgba(0,0,0,0.45) 100%);
      border:1px solid rgba(255,255,255,0.7);
      border-radius:4px;
      cursor:pointer;
      transition:background 160ms ease,border-color 160ms ease,transform 160ms ease;
    }
    button:disabled {
      opacity:0.45;
      cursor:not-allowed;
      filter:saturate(0.6);
    }
    button:hover {
      background:linear-gradient(180deg, rgba(0,255,255,0.35) 0%, rgba(0,0,0,0.55) 100%);
      border-color:var(--accent);
    }
    button:focus-visible {
      outline:2px solid var(--accent);
      outline-offset:2px;
    }
    .overlay {position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;font-family:monospace;font-size:16px;text-align:center;pointer-events:none;}
    .overlay.hidden {display:none;}
    #completionMenu {position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);color:#fff;font-family:monospace;padding:20px;}
    #completionMenu.active {display:flex;}
    .completion-content {border:2px solid var(--panel-border);background:var(--panel-bg);padding:24px;width:min(90vw,360px);text-align:center;display:flex;flex-direction:column;gap:14px;box-shadow:0 12px 32px rgba(0,0,0,0.55);}
    .completion-content h2 {margin:0;font-size:22px;letter-spacing:2px;text-transform:uppercase;}
    .completion-content h3 {margin:0;letter-spacing:1px;text-transform:uppercase;font-size:14px;color:var(--accent);}
    .completion-content p {margin:0;font-size:14px;color:var(--text-muted);}
    .completion-content form {display:flex;flex-direction:column;gap:6px;}
    .completion-content label {font-size:12px;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);}
    .completion-content input {padding:6px;font-family:monospace;background:#000;border:1px solid rgba(255,255,255,0.7);color:#fff;border-radius:4px;width:100%;}
    .completion-content button {margin-top:0;width:100%;}
    .leaderboard-list {text-align:left;margin:0 auto;padding-left:20px;}
    .leaderboard-list li {margin-bottom:4px;}
    .leaderboard-list li.highlight {color:#0ff;font-weight:bold;}
    .fullscreen-overlay {position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:32px;background:rgba(0,0,0,0.85);color:#fff;font-family:monospace;z-index:20;backdrop-filter:blur(4px);}
    .menu-panel {position:relative;border:2px solid var(--panel-border);background:var(--panel-bg);padding:26px 28px 30px;width:min(90vw,360px);text-align:left;display:flex;flex-direction:column;gap:16px;box-shadow:0 12px 32px rgba(0,0,0,0.55);}
    .menu-panel::after {content:"";position:absolute;inset:12px;border:1px solid rgba(255,255,255,0.15);pointer-events:none;}
    .menu-panel h1 {margin:0;font-size:26px;letter-spacing:4px;text-transform:uppercase;}
    .menu-panel p {margin:0;font-size:14px;color:var(--text-muted);}
    .menu-panel form {display:flex;flex-direction:column;gap:10px;}
    .menu-panel label {font-size:12px;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);}
    .menu-panel input {padding:8px 10px;font-family:monospace;background:#000;border:1px solid rgba(255,255,255,0.7);color:#fff;border-radius:4px;width:100%;}
    .menu-buttons {display:flex;flex-direction:column;gap:10px;width:100%;}
    .menu-buttons button {margin-top:0;width:100%;}
    .menu-leaderboard {border-top:1px solid rgba(255,255,255,0.15);padding-top:14px;display:flex;flex-direction:column;gap:8px;}
    .menu-leaderboard h2 {margin:0;font-size:16px;letter-spacing:2px;text-transform:uppercase;}
    .leaderboard-scroll {max-height:220px;overflow-y:auto;padding-right:6px;}
    .completion-content .submit-info {font-size:12px;text-transform:uppercase;letter-spacing:1px;color:#0ff;}
  </style>


</head>
<body>
  <div id="welcomeScreen" class="fullscreen-overlay hidden">
    <div class="menu-panel">
      <h1>Welcome</h1>
      <p>Enter your name to begin</p>
      <form id="welcomeForm">
        <label for="welcomeName">Player Name</label>
        <input id="welcomeName" type="text" maxlength="16" autocomplete="name" placeholder="Player" />
        <button type="submit">Continue</button>
      </form>
    </div>
  </div>

  <div id="mainMenu" class="fullscreen-overlay hidden">
    <div class="menu-panel">
      <h1>PLATFORMER</h1>
      <p>Current Name: <span id="menuPlayerName">Player</span></p>
      <div class="menu-buttons">
        <button id="playBtn" type="button">Play</button>
        <button id="settingsBtn" type="button">Settings</button>
      </div>
      <div class="menu-leaderboard">
        <h2>Top 20 Runs</h2>
        <ol id="menuLeaderboard" class="leaderboard-list leaderboard-scroll"></ol>
      </div>
    </div>
  </div>

  <div id="settingsMenu" class="fullscreen-overlay hidden">
    <div class="menu-panel">
      <h1>Settings</h1>
      <form id="settingsForm">
        <label for="settingsName">Player Name</label>
        <input id="settingsName" type="text" maxlength="16" autocomplete="name" />
        <div class="menu-buttons">
          <button type="submit">Confirm</button>
          <button type="button" id="settingsCancel">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <div id="hud" class="hud hidden">
    <span id="levelText">Level: 1 / 3</span> |
    <span id="timeText">00:00.000</span>
    <button id="restartBtn">Restart</button>
  </div>
  <div id="gameWrapper" class="hidden" style="position:relative;">
    <canvas id="game" width="900" height="520"></canvas>
    <div id="overlay" class="overlay"></div>
    <div id="completionMenu">
      <div class="completion-content">
        <h2>Complete!</h2>
        <p>Your time: <span id="finalTime">00:00.000</span></p>
        <div class="submit-info">Submitting as: <span id="scorePlayerName">Player</span></div>
        <button id="submitScoreBtn" type="button">Submit Score</button>
        <div>
          <h3>Top 5</h3>
          <ol id="leaderboard" class="leaderboard-list"></ol>
        </div>
        <button id="menuRestartBtn" type="button">Back to Menu</button>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    socket.on('connect', () => {
      console.log('Connected to server', socket.id);
    });

    const canvas=document.getElementById('game');
    const ctx=canvas.getContext('2d');
    const W=canvas.width,H=canvas.height;

    const player={x:60,y:0,w:20,h:20,vx:0,vy:0,onGround:false,jumpsUsed:0}; // square player
    const GRAVITY=0.8,SPEED=6,JUMP_V=-14;
    const BASE_FRAME=1000/60;
    const MAX_FRAME=BASE_FRAME*3;

    function makeDot(x,y){return{x,y,hitR:18,collected:false};}

    const levels=[
      {spawn:{x:60,y:380},plats:[{x:0,y:480,w:900,h:40,color:'rgb(85,85,85)'},{x:140,y:420,w:160,h:20,color:'rgb(85,85,85)'},{x:360,y:360,w:120,h:20,color:'rgb(85,85,85)'},{x:560,y:300,w:160,h:20,color:'rgb(85,85,85)'},{x:760,y:260,w:100,h:20,color:'rgb(85,85,85)'}],dots:[makeDot(180,400),makeDot(420,340),makeDot(600,280),makeDot(800,240)]},
      {spawn:{x:40,y:420},plats:[{x:0,y:480,w:900,h:40,color:'rgb(85,85,85)'},{x:120,y:420,w:100,h:20,color:'rgb(85,85,85)'},{x:280,y:370,w:120,h:20,color:'rgb(85,85,85)'},{x:470,y:420,w:120,h:20,color:'rgb(85,85,85)'},{x:640,y:360,w:120,h:20,color:'rgb(85,85,85)'},{x:820,y:300,w:80,h:20,color:'rgb(85,85,85)'},{x:740,y:240,w:60,h:20,color:'rgb(85,85,85)'}],dots:[makeDot(160,400),makeDot(320,350),makeDot(520,400),makeDot(680,340),makeDot(850,280)]},
      {spawn:{x:60,y:440},plats:[{x:0,y:480,w:900,h:40,color:'rgb(85,85,85)'},{x:120,y:430,w:90,h:20,color:'rgb(85,85,85)'},{x:240,y:380,w:90,h:20,color:'rgb(85,85,85)'},{x:360,y:330,w:90,h:20,color:'rgb(85,85,85)'},{x:480,y:280,w:90,h:20,color:'rgb(85,85,85)'},{x:600,y:230,w:90,h:20,color:'rgb(85,85,85)'},{x:720,y:185,w:120,h:20,color:'rgb(85,85,85)'},{x:820,y:145,w:60,h:20,color:'rgb(85,85,85)'}],dots:[makeDot(150,410),makeDot(270,360),makeDot(390,310),makeDot(510,260),makeDot(630,210),makeDot(760,170),makeDot(850,130)]}
    ];

    let levelIdx=0,firstMoveArmed=true,timerStart=null,timerEnd=null,scoreSubmitted=false,highlightedEntry=null;
    let appState='welcome';
    let animationId=null;

    const keys=new Set();
    const startKeys=new Set(['ArrowLeft','ArrowRight','KeyA','KeyD','Space','KeyW','ArrowUp']);

    window.addEventListener('keydown',e=>{
      if(appState!=='game')return;
      keys.add(e.code);
      if(firstMoveArmed&&levelIdx===0&&startKeys.has(e.code)){
        firstMoveArmed=false;timerStart=performance.now();timerEnd=null;overlay("");
      }
      if(['Space','KeyW','ArrowUp'].includes(e.code)){
        if(player.onGround){
          spawnJumpTriangles();
          player.vy=JUMP_V;
          player.onGround=false;
          player.jumpsUsed=1;
        } else if(player.jumpsUsed<2){
          // double jump
          player.vy=JUMP_V;
          player.jumpsUsed++;
          particles.push({x:player.x+player.w/2,y:player.y+player.h+2,w:player.w+6,alpha:1}); // wider line
        }
      }
    });
    window.addEventListener('keyup',e=>{
      if(appState!=='game')return;
      keys.delete(e.code);
    });

    const timeText=document.getElementById('timeText');
    const levelText=document.getElementById('levelText');
    const overlayEl=document.getElementById('overlay');
    const completionMenu=document.getElementById('completionMenu');
    const finalTimeEl=document.getElementById('finalTime');
    const leaderboardEl=document.getElementById('leaderboard');
    const menuLeaderboardEl=document.getElementById('menuLeaderboard');
    const submitScoreBtn=document.getElementById('submitScoreBtn');
    const scorePlayerNameEl=document.getElementById('scorePlayerName');
    const menuRestartBtn=document.getElementById('menuRestartBtn');
    const restartBtn=document.getElementById('restartBtn');
    const hud=document.getElementById('hud');
    const gameWrapper=document.getElementById('gameWrapper');
    const welcomeScreen=document.getElementById('welcomeScreen');
    const mainMenu=document.getElementById('mainMenu');
    const settingsMenu=document.getElementById('settingsMenu');
    const welcomeForm=document.getElementById('welcomeForm');
    const welcomeNameInput=document.getElementById('welcomeName');
    const playBtn=document.getElementById('playBtn');
    const settingsBtn=document.getElementById('settingsBtn');
    const settingsForm=document.getElementById('settingsForm');
    const settingsNameInput=document.getElementById('settingsName');
    const settingsCancelBtn=document.getElementById('settingsCancel');
    const menuPlayerNameEl=document.getElementById('menuPlayerName');

    function fmt(ms){if(ms==null)return'00:00.000';const t=Math.floor(ms);const m=Math.floor(t/60000);const s=Math.floor((t%60000)/1000);const ms3=String(t%1000).padStart(3,'0');return`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}.${ms3}`;}
    function updateTimerUI(){const t=timerEnd??(timerStart?performance.now()-timerStart:0);timeText.textContent=fmt(t);} 
    function overlay(msg){if(msg){overlayEl.textContent=msg;overlayEl.classList.remove('hidden');}else{overlayEl.textContent='';overlayEl.classList.add('hidden');}}

    const LB_KEY='retroPlatformerLB';
    const NAME_KEY='retroPlatformerName';
    const LB_MAX_ENTRIES=20;
    function loadLB(){try{return JSON.parse(localStorage.getItem(LB_KEY))||[]}catch{return[]}}
    function saveLB(a){localStorage.setItem(LB_KEY,JSON.stringify(a));}
    function loadName(){try{return localStorage.getItem(NAME_KEY)||'';}catch{return'';}}
    function saveNameValue(name){try{localStorage.setItem(NAME_KEY,name);}catch{}}
    function sanitizeName(value){return(value||'').trim().slice(0,16);}
    const storedName=sanitizeName(loadName());
    const hadStoredName=!!storedName;
    let currentPlayerName=storedName||'Player';
    function updateNameDisplays(){if(menuPlayerNameEl)menuPlayerNameEl.textContent=currentPlayerName;if(scorePlayerNameEl)scorePlayerNameEl.textContent=currentPlayerName;}
    function setPlayerName(value){const sanitized=sanitizeName(value);currentPlayerName=sanitized||'Player';saveNameValue(currentPlayerName);updateNameDisplays();}
    function pushTime(ms,name){
      const cleanName=sanitizeName(name)||'Player';
      if(!cleanName)return false;
      const arr=loadLB();
      const entry={ms,name:cleanName};
      arr.push(entry);
      arr.sort((a,b)=>a.ms-b.ms);
      let kept=true;
      while(arr.length>LB_MAX_ENTRIES){
        const removed=arr.pop();
        if(removed===entry)kept=false;
      }
      highlightedEntry=kept?{ms:entry.ms,name:entry.name}:null;
      saveLB(arr);
      return kept;
    }
    function renderLeaderboard(targetEl,{limit=Infinity,highlight=null}={}){
      if(!targetEl)return;
      const arr=loadLB();
      if(!arr.length){
        targetEl.innerHTML='<li>No times yet</li>';
        return;
      }
      let highlightUsed=false;
      const entries=arr.slice(0,limit).map(x=>{
        const shouldHighlight=!highlightUsed&&highlight&&x.ms===highlight.ms&&x.name===highlight.name;
        if(shouldHighlight)highlightUsed=true;
        const cls=shouldHighlight?' class="highlight"':'';
        return `<li${cls}>${x.name}: ${fmt(x.ms)}</li>`;
      });
      targetEl.innerHTML=entries.join('');
    }
    function updateLeaderboards(){
      renderLeaderboard(leaderboardEl,{limit:5,highlight:highlightedEntry});
      renderLeaderboard(menuLeaderboardEl,{limit:LB_MAX_ENTRIES});
    }
    function showCompletionMenu(){
      if(timerEnd==null)return;
      finalTimeEl.textContent=fmt(timerEnd);
      updateNameDisplays();
      updateLeaderboards();
      completionMenu.classList.add('active');
      if(submitScoreBtn)submitScoreBtn.disabled=scoreSubmitted;
    }
    function hideCompletionMenu(){
      completionMenu.classList.remove('active');
    }

    function currentLevel(){return levels[levelIdx];}
    function resetDots(lvl){for(const d of lvl.dots){d.collected=false;}}
    function resetToSpawn(){const lvl=currentLevel();player.x=lvl.spawn.x;player.y=lvl.spawn.y;player.vx=0;player.vy=0;player.onGround=false;player.jumpsUsed=0;}
    function loadLevel(i){
      hideCompletionMenu();
      levelIdx=i;
      const lvl=currentLevel();
      resetDots(lvl);
      levelText.textContent=`Level: ${levelIdx+1} / ${levels.length}`;
      resetToSpawn();
      if(levelIdx===0){
        firstMoveArmed=true;
        timerStart=null;
        timerEnd=null;
        scoreSubmitted=false;
        highlightedEntry=null;
        if(submitScoreBtn)submitScoreBtn.disabled=false;
        overlay('PRESS ANY MOVE KEY TO START');
      }else overlay('');
    }

    function aabb(a,b){return!(a.x+a.w<=b.x||a.x>=b.x+b.w||a.y+a.h<=b.y||a.y>=b.y+b.h);}
    function resolve(px,py,vx,vy){const lvl=currentLevel();const box={x:px,y:py,w:player.w,h:player.h};let onGround=false;for(const r of lvl.plats){if(!aabb(box,r))continue;const dx1=(r.x+r.w)-box.x,dx2=(box.x+box.w)-r.x,dy1=(r.y+r.h)-box.y,dy2=(box.y+box.h)-r.y;const penX=Math.min(dx1,dx2),penY=Math.min(dy1,dy2);if(penX<penY){if(dx1<dx2){box.x=r.x+r.w;}else{box.x=r.x-box.w;}vx=0;}else{if(dy1<dy2){box.y=r.y+r.h;vy=Math.max(0,vy);}else{box.y=r.y-box.h;vy=0;onGround=true;}}}if(box.x<0){box.x=0;vx=0;}if(box.x+box.w>W){box.x=W-box.w;vx=0;}return{x:box.x,y:box.y,vx,vy,onGround};}

    const particles=[];
    const triangles=[];

    function spawnJumpTriangles(){
      const lvl=currentLevel();
      for(const r of lvl.plats){
        if(player.x+player.w>r.x && player.x<r.x+r.w && Math.abs(player.y+player.h-r.y)<5){
          const count=3+Math.floor(Math.random()*3);
          for(let i=0;i<count;i++){
            const side=(player.x+player.w/2<r.x+r.w/2)?-1:1;
            const angle=(Math.random()*0.5+0.25)*Math.PI*side;
            triangles.push({
              x:player.x+player.w/2,
              y:r.y,
              size:4+Math.random()*3,
              alpha:1,
              dx:Math.cos(angle)*1.5,
              dy:-Math.random()*1.5-0.5,
              color:r.color
            });
          }
          break;
        }
      }
    }

    function tick(dt){
      const left=keys.has('ArrowLeft')||keys.has('KeyA');
      const right=keys.has('ArrowRight')||keys.has('KeyD');

      if(left) player.vx=-SPEED; else if(right) player.vx=SPEED; else player.vx=0;

      player.vy+=GRAVITY*dt;
      let nx=player.x+player.vx*dt,ny=player.y+player.vy*dt;
      const r=resolve(nx,ny,player.vx,player.vy);
      player.x=r.x;player.y=r.y;player.vx=r.vx;player.vy=r.vy;player.onGround=r.onGround;if(player.onGround)player.jumpsUsed=0;
      if(player.y>H+200)resetToSpawn();

      const lvl=currentLevel();
      for(const d of lvl.dots){if(d.collected)continue;const dx=(player.x+player.w/2)-d.x,dy=(player.y+player.h/2)-d.y;if(dx*dx+dy*dy<d.hitR*d.hitR){d.collected=true;}}
      if(lvl.dots.every(d=>d.collected)){
        if(levelIdx<levels.length-1)loadLevel(levelIdx+1);
        else{
          if(!timerEnd&&timerStart){
            timerEnd=performance.now()-timerStart;
          }
          overlay('');
          if(!completionMenu.classList.contains('active')){
            showCompletionMenu();
          }
        }
      }

      for(const p of particles){p.y+=2*dt;p.alpha-=0.05*dt;}while(particles.length&&particles[0].alpha<=0)particles.shift();
      for(const t of triangles){t.x+=t.dx*dt;t.y+=t.dy*dt;t.alpha-=0.04*dt;}while(triangles.length&&triangles[0].alpha<=0)triangles.shift();

      draw();updateTimerUI();
    }

    function draw(){
      ctx.clearRect(0,0,W,H);
      ctx.fillStyle='#000';ctx.fillRect(0,0,W,H);
      for(const r of currentLevel().plats){ctx.fillStyle=r.color;ctx.fillRect(r.x,r.y,r.w,r.h);} 
      ctx.fillStyle='red';for(const d of currentLevel().dots)if(!d.collected)ctx.fillRect(d.x-3,d.y-3,6,6);
      ctx.fillStyle='#fff';ctx.fillRect(player.x,player.y,player.w,player.h);
      for(const p of particles){ctx.fillStyle=`rgba(255,255,255,${p.alpha})`;ctx.fillRect(p.x-p.w/2,p.y,p.w,2);} 
      for(const t of triangles){
        ctx.fillStyle=`rgba(85,85,85,${t.alpha})`;
        ctx.beginPath();
        ctx.moveTo(t.x,t.y);
        ctx.lineTo(t.x+t.size,t.y+t.size);
        ctx.lineTo(t.x-t.size,t.y+t.size);
        ctx.closePath();
        ctx.fill();
      }
    }

    function clearInputs(){keys.clear();}
    function updateVisibility(){
      hud.classList.toggle('hidden',appState!=='game');
      gameWrapper.classList.toggle('hidden',appState!=='game');
      welcomeScreen.classList.toggle('hidden',appState!=='welcome');
      mainMenu.classList.toggle('hidden',appState!=='menu');
      settingsMenu.classList.toggle('hidden',appState!=='settings');
    }
    let lastFrameTime=null;
    function stopLoop(){
      if(animationId!=null){cancelAnimationFrame(animationId);animationId=null;}
      lastFrameTime=null;
    }
    function startLoop(){
      stopLoop();
      const frame=now=>{
        if(appState!=='game'){animationId=null;lastFrameTime=null;return;}
        if(lastFrameTime==null){lastFrameTime=now;animationId=requestAnimationFrame(frame);return;}
        const delta=Math.min(MAX_FRAME,now-lastFrameTime);
        const dt=delta/BASE_FRAME;
        lastFrameTime=now;
        if(dt>0)tick(dt);
        animationId=requestAnimationFrame(frame);
      };
      animationId=requestAnimationFrame(frame);
    }
    function showWelcome(){
      appState='welcome';
      updateVisibility();
      stopLoop();
      clearInputs();
      hideCompletionMenu();
      overlay('');
      if(welcomeForm)welcomeForm.reset();
      if(welcomeNameInput)setTimeout(()=>welcomeNameInput.focus(),0);
    }
    function showMainMenu(){
      appState='menu';
      updateVisibility();
      stopLoop();
      clearInputs();
      hideCompletionMenu();
      overlay('');
      updateLeaderboards();
      updateNameDisplays();
    }
    function showSettings(){
      appState='settings';
      updateVisibility();
      stopLoop();
      clearInputs();
      hideCompletionMenu();
      overlay('');
      if(settingsNameInput){settingsNameInput.value=currentPlayerName;setTimeout(()=>settingsNameInput.select(),0);} 
    }
    function startGame(){
      appState='game';
      updateVisibility();
      hideCompletionMenu();
      clearInputs();
      loadLevel(0);
      resetToSpawn();
      updateNameDisplays();
      draw();
      updateTimerUI();
      startLoop();
    }

    restartBtn.addEventListener('click',()=>{showMainMenu();});
    menuRestartBtn.addEventListener('click',()=>{showMainMenu();});
    submitScoreBtn.addEventListener('click',()=>{
      if(timerEnd==null||scoreSubmitted)return;
      pushTime(timerEnd,currentPlayerName);
      updateLeaderboards();
      scoreSubmitted=true;
      submitScoreBtn.disabled=true;
      updateNameDisplays();
    });
    welcomeForm.addEventListener('submit',e=>{
      e.preventDefault();
      setPlayerName(welcomeNameInput.value);
      showMainMenu();
    });
    playBtn.addEventListener('click',()=>{startGame();});
    settingsBtn.addEventListener('click',()=>{showSettings();});
    settingsForm.addEventListener('submit',e=>{
      e.preventDefault();
      setPlayerName(settingsNameInput.value);
      showMainMenu();
    });
    settingsCancelBtn.addEventListener('click',()=>{
      if(settingsForm)settingsForm.reset();
      showMainMenu();
    });

    function init(){
      updateNameDisplays();
      updateLeaderboards();
      if(hadStoredName){
        showMainMenu();
      }else{
        showWelcome();
      }
    }
    init();
  </script>
</body>
</html>
